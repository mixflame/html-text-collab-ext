{"version":3,"file":"html-text-collab-ext.min.js","sources":["html-text-collab-ext.js"],"sourcesContent":["/**\n * Â© 2018 Convergence Labs, Inc.\n * @version 0.2.4\n * @license MIT\n */\n\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n    (global = global || self, factory(global.HtmlTextCollabExt = {}));\n}(this, (function (exports) { 'use strict';\n\n    /*! *****************************************************************************\r\n    Copyright (c) Microsoft Corporation.\r\n\r\n    Permission to use, copy, modify, and/or distribute this software for any\r\n    purpose with or without fee is hereby granted.\r\n\r\n    THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\n    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\n    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\n    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\n    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\n    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\n    PERFORMANCE OF THIS SOFTWARE.\r\n    ***************************************************************************** */\r\n\r\n    var __assign = function() {\r\n        __assign = Object.assign || function __assign(t) {\r\n            for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n                s = arguments[i];\r\n                for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n            }\r\n            return t;\r\n        };\r\n        return __assign.apply(this, arguments);\r\n    };\n\n    function unwrapExports (x) {\n    \treturn x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n    }\n\n    function createCommonjsModule(fn, module) {\n    \treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n    }\n\n    var textareaCaret = createCommonjsModule(function (module) {\n    /* jshint browser: true */\n\n    (function () {\n\n    // We'll copy the properties below into the mirror div.\n    // Note that some browsers, such as Firefox, do not concatenate properties\n    // into their shorthand (e.g. padding-top, padding-bottom etc. -> padding),\n    // so we have to list every single property explicitly.\n    var properties = [\n      'direction',  // RTL support\n      'boxSizing',\n      'width',  // on Chrome and IE, exclude the scrollbar, so the mirror div wraps exactly as the textarea does\n      'height',\n      'overflowX',\n      'overflowY',  // copy the scrollbar for IE\n\n      'borderTopWidth',\n      'borderRightWidth',\n      'borderBottomWidth',\n      'borderLeftWidth',\n      'borderTopStyle',\n      'borderRightStyle',\n      'borderBottomStyle',\n      'borderLeftStyle',\n\n      'paddingTop',\n      'paddingRight',\n      'paddingBottom',\n      'paddingLeft',\n\n      // https://developer.mozilla.org/en-US/docs/Web/CSS/font\n      'fontStyle',\n      'fontVariant',\n      'fontWeight',\n      'fontStretch',\n      'fontSize',\n      'fontSizeAdjust',\n      'lineHeight',\n      'fontFamily',\n\n      'textAlign',\n      'textTransform',\n      'textIndent',\n      'textDecoration',  // might not make a difference, but better be safe\n\n      'letterSpacing',\n      'wordSpacing',\n\n      'tabSize',\n      'MozTabSize'\n\n    ];\n\n    var isBrowser = (typeof window !== 'undefined');\n    var isFirefox = (isBrowser && window.mozInnerScreenX != null);\n\n    function getCaretCoordinates(element, position, options) {\n      if (!isBrowser) {\n        throw new Error('textarea-caret-position#getCaretCoordinates should only be called in a browser');\n      }\n\n      var debug = options && options.debug || false;\n      if (debug) {\n        var el = document.querySelector('#input-textarea-caret-position-mirror-div');\n        if (el) el.parentNode.removeChild(el);\n      }\n\n      // The mirror div will replicate the textarea's style\n      var div = document.createElement('div');\n      div.id = 'input-textarea-caret-position-mirror-div';\n      document.body.appendChild(div);\n\n      var style = div.style;\n      var computed = window.getComputedStyle ? window.getComputedStyle(element) : element.currentStyle;  // currentStyle for IE < 9\n      var isInput = element.nodeName === 'INPUT';\n\n      // Default textarea styles\n      style.whiteSpace = 'pre-wrap';\n      if (!isInput)\n        style.wordWrap = 'break-word';  // only for textarea-s\n\n      // Position off-screen\n      style.position = 'absolute';  // required to return coordinates properly\n      if (!debug)\n        style.visibility = 'hidden';  // not 'display: none' because we want rendering\n\n      // Transfer the element's properties to the div\n      properties.forEach(function (prop) {\n        if (isInput && prop === 'lineHeight') {\n          // Special case for <input>s because text is rendered centered and line height may be != height\n          style.lineHeight = computed.height;\n        } else {\n          style[prop] = computed[prop];\n        }\n      });\n\n      if (isFirefox) {\n        // Firefox lies about the overflow property for textareas: https://bugzilla.mozilla.org/show_bug.cgi?id=984275\n        if (element.scrollHeight > parseInt(computed.height))\n          style.overflowY = 'scroll';\n      }\n\n      div.textContent = element.value.substring(0, position);\n      // The second special handling for input type=\"text\" vs textarea:\n      // spaces need to be replaced with non-breaking spaces - http://stackoverflow.com/a/13402035/1269037\n      if (isInput)\n        div.textContent = div.textContent.replace(/\\s/g, '\\u00a0');\n\n      var span = document.createElement('span');\n      // Wrapping must be replicated *exactly*, including when a long word gets\n      // onto the next line, with whitespace at the end of the line before (#7).\n      // The  *only* reliable way to do that is to copy the *entire* rest of the\n      // textarea's content into the <span> created at the caret position.\n      // For inputs, just '.' would be enough, but no need to bother.\n      span.textContent = element.value.substring(position) || '.';  // || because a completely empty faux span doesn't render at all\n      div.appendChild(span);\n\n      var coordinates = {\n        top: span.offsetTop + parseInt(computed['borderTopWidth']),\n        left: span.offsetLeft + parseInt(computed['borderLeftWidth']),\n        height: parseInt(computed['lineHeight'])\n      };\n\n      if (debug) {\n        span.style.backgroundColor = '#aaa';\n      } else {\n        document.body.removeChild(div);\n      }\n\n      return coordinates;\n    }\n\n    {\n      module.exports = getCaretCoordinates;\n    }\n\n    }());\n    });\n\n    /*\r\n     * Copyright (c) 2019 Convergence Labs, Inc.\r\n     *\r\n     * This file is part of the HTML Text Collaborative Extensions, which is\r\n     * released under the terms of the MIT license. A copy of the MIT license\r\n     * is usually provided as part of this source code package in the LICENCE\r\n     * file. If it was not, please see <https://opensource.org/licenses/MIT>\r\n     */\r\n    /**\r\n     * Computes the dimensions of the text selection.  Each line in the textarea has its own\r\n     * selection dimensions, which are intended to be used to render a div with the specified\r\n     * position, dimensions and background color.\r\n     *\r\n     * This has only been tested on a textarea, but should be able to be adapted to be used\r\n     * in other HTML form elements.\r\n     *\r\n     * TODO unit test, this is pretty brittle\r\n     */\r\n    var SelectionComputer = /** @class */ (function () {\r\n        function SelectionComputer(element, start, end) {\r\n            this.element = element;\r\n            this.start = start;\r\n            this.end = end;\r\n            this.startCoordinates = textareaCaret(element, start);\r\n            this.endCoordinates = textareaCaret(element, end);\r\n            this.lineHeight = this.startCoordinates.height;\r\n            this.elementPaddingLeft = parseFloat(element.style.paddingLeft) || 0;\r\n            this.elementPaddingRight = parseFloat(element.style.paddingRight) || 0;\r\n            this.elementPaddingX = this.elementPaddingLeft + this.elementPaddingRight;\r\n            this.selectionRows = [];\r\n            // Figure out whether this selection spans more than one \"row\", as determined by\r\n            // the presence of a newline character. The computation of single line selections\r\n            // is slightly different than for multiple line selections.\r\n            var selectedText = element.value.substr(start, end - start);\r\n            if (selectedText.indexOf('\\n') < 0) {\r\n                this.appendSingleLineSelection(this.startCoordinates, this.endCoordinates);\r\n            }\r\n            else {\r\n                this.buildMultiRowSelection();\r\n            }\r\n        }\r\n        SelectionComputer.calculateSelection = function (element, start, end) {\r\n            var computer = new SelectionComputer(element, start, end);\r\n            return computer.selectionRows;\r\n        };\r\n        SelectionComputer.prototype.appendSingleLineSelection = function (startCoordinates, endCoordinates) {\r\n            var _a;\r\n            (_a = this.selectionRows).push.apply(_a, this.buildSingleLineSelection(startCoordinates, endCoordinates));\r\n        };\r\n        SelectionComputer.prototype.buildSingleLineSelection = function (startCoordinates, endCoordinates) {\r\n            // does this line wrap? If not, we can just calculate the row selection based on\r\n            // the provided coordinates.\r\n            if (startCoordinates.top === endCoordinates.top) {\r\n                return [{\r\n                        width: endCoordinates.left - startCoordinates.left,\r\n                        top: startCoordinates.top,\r\n                        left: startCoordinates.left,\r\n                        height: this.lineHeight\r\n                    }];\r\n            }\r\n            else {\r\n                return this.buildWrappedLineSelections(startCoordinates, endCoordinates);\r\n            }\r\n        };\r\n        /**\r\n         * Wrapped lines have a more complex computation since we have to create multiple\r\n         * rows.\r\n         *\r\n         * @param startCoordinates\r\n         * @param endCoordinates\r\n         */\r\n        SelectionComputer.prototype.buildWrappedLineSelections = function (startCoordinates, endCoordinates) {\r\n            var rows = [];\r\n            // the first line just goes the full width of the textarea\r\n            rows.push({\r\n                width: this.element.scrollWidth - this.elementPaddingRight - startCoordinates.left,\r\n                top: startCoordinates.top,\r\n                left: startCoordinates.left,\r\n                height: this.lineHeight\r\n            });\r\n            // If the selection contains one or more rows that span the entire textarea,\r\n            // calculate a single selection element, which may actually span multiple rows,\r\n            // but fills the width of the textarea.\r\n            if (endCoordinates.top > startCoordinates.top + this.lineHeight) {\r\n                rows.push({\r\n                    width: this.element.scrollWidth - this.elementPaddingX,\r\n                    left: this.elementPaddingLeft,\r\n                    top: startCoordinates.top + this.lineHeight,\r\n                    height: endCoordinates.top - startCoordinates.top - this.lineHeight\r\n                });\r\n            }\r\n            // The last line starts at the left edge of the textarea and doesn't span the\r\n            // entire width of the textarea\r\n            rows.push({\r\n                width: endCoordinates.left - this.elementPaddingLeft,\r\n                top: endCoordinates.top,\r\n                left: this.elementPaddingLeft,\r\n                height: this.lineHeight\r\n            });\r\n            return rows;\r\n        };\r\n        SelectionComputer.prototype.buildMultiRowSelection = function () {\r\n            var currentCoordinates = this.startCoordinates;\r\n            var currentIndex = +this.start;\r\n            // build one or more selection elements for each row (as determined by newline\r\n            // characters)\r\n            while (currentCoordinates.top < this.endCoordinates.top) {\r\n                var nextLineBreakPosition = this.element.value.indexOf('\\n', currentIndex);\r\n                var endOfLinePosition = this.element.value.length;\r\n                if (nextLineBreakPosition >= 0) {\r\n                    endOfLinePosition = nextLineBreakPosition;\r\n                }\r\n                if (endOfLinePosition > this.end) {\r\n                    endOfLinePosition = this.end;\r\n                }\r\n                var endOfLineCoordinates = textareaCaret(this.element, endOfLinePosition);\r\n                // console.log('target of line position', endOfLinePosition, 'coords', endOfLineCoordinates);\r\n                // This \"single line\" may actually wrap multiple lines of the textarea\r\n                this.appendSingleLineSelection(currentCoordinates, endOfLineCoordinates);\r\n                currentIndex = endOfLinePosition + 1;\r\n                currentCoordinates = textareaCaret(this.element, currentIndex);\r\n            }\r\n            if (currentIndex < this.end) {\r\n                var lastLine = {\r\n                    width: this.endCoordinates.left - currentCoordinates.left,\r\n                    top: currentCoordinates.top,\r\n                    left: currentCoordinates.left,\r\n                    height: this.lineHeight\r\n                };\r\n                this.selectionRows.push(lastLine);\r\n            }\r\n        };\r\n        return SelectionComputer;\r\n    }());\n\n    /*\r\n     * Copyright (c) 2019 Convergence Labs, Inc.\r\n     *\r\n     * This file is part of the HTML Text Collaborative Extensions, which is\r\n     * released under the terms of the MIT license. A copy of the MIT license\r\n     * is usually provided as part of this source code package in the LICENCE\r\n     * file. If it was not, please see <https://opensource.org/licenses/MIT>\r\n     */\r\n    /**\r\n     * This class represents a specific collaborators selection and controls\r\n     * the rendering of the remote cursor / selection.\r\n     */\r\n    var CollaboratorSelection = /** @class */ (function () {\r\n        function CollaboratorSelection(textInput, overlayContainer, color, label, options) {\r\n            this._label = label;\r\n            this._textInput = textInput;\r\n            this._color = color;\r\n            this._cursor = null;\r\n            this._selection = null;\r\n            this._rows = [];\r\n            this._container = overlayContainer;\r\n            options = options || {};\r\n            this._margin = options.margin || 5;\r\n            this._tooltipTimeout = null;\r\n            this._cursorElement = this._container.ownerDocument.createElement(\"div\");\r\n            this._cursorElement.className = \"collaborator-cursor\";\r\n            this._cursorElement.style.backgroundColor = this._color;\r\n            this._tooltipElement = this._container.ownerDocument.createElement(\"div\");\r\n            this._tooltipElement.innerHTML = label;\r\n            this._tooltipElement.className = \"collaborator-cursor-tooltip\";\r\n            this._tooltipElement.style.backgroundColor = this._color;\r\n            this.hideCursorTooltip();\r\n            this.refresh();\r\n        }\r\n        CollaboratorSelection.prototype.showSelection = function () {\r\n            this._rows.forEach(function (row) {\r\n                row.element.style.visibility = \"visible\";\r\n            });\r\n        };\r\n        CollaboratorSelection.prototype.hideSelection = function () {\r\n            this._rows.forEach(function (row) {\r\n                row.element.style.visibility = \"hidden\";\r\n            });\r\n        };\r\n        CollaboratorSelection.prototype.showCursor = function () {\r\n            this._cursorElement.style.visibility = \"visible\";\r\n        };\r\n        CollaboratorSelection.prototype.hideCursor = function () {\r\n            this._cursorElement.style.visibility = \"hidden\";\r\n        };\r\n        CollaboratorSelection.prototype.showCursorToolTip = function () {\r\n            this._clearToolTipTimeout();\r\n            this._tooltipElement.style.opacity = \"1\";\r\n        };\r\n        CollaboratorSelection.prototype.flashCursorToolTip = function (duration) {\r\n            var _this = this;\r\n            this.showCursorToolTip();\r\n            this._clearToolTipTimeout();\r\n            this._tooltipTimeout = setTimeout(function () { return _this.hideCursorTooltip(); }, duration * 1000);\r\n        };\r\n        CollaboratorSelection.prototype.hideCursorTooltip = function () {\r\n            this._clearToolTipTimeout();\r\n            this._tooltipElement.style.opacity = \"0\";\r\n        };\r\n        CollaboratorSelection.prototype._clearToolTipTimeout = function () {\r\n            if (this._tooltipTimeout !== null) {\r\n                clearTimeout(this._tooltipTimeout);\r\n                this._tooltipTimeout = null;\r\n            }\r\n        };\r\n        CollaboratorSelection.prototype.setColor = function (color) {\r\n            var _this = this;\r\n            this._color = color;\r\n            this._rows.forEach(function (row) {\r\n                row.element.style.background = _this._color;\r\n            });\r\n            this._cursorElement.style.background = this._color;\r\n            this._tooltipElement.style.background = this._color;\r\n        };\r\n        CollaboratorSelection.prototype.setSelection = function (selection) {\r\n            if (selection === null) {\r\n                this._cursor = null;\r\n                this._selection = null;\r\n            }\r\n            else {\r\n                this._cursor = selection.target;\r\n                this._selection = __assign({}, selection);\r\n            }\r\n            this.refresh();\r\n        };\r\n        CollaboratorSelection.prototype.getSelection = function () {\r\n            return __assign({}, this._selection);\r\n        };\r\n        CollaboratorSelection.prototype.clearSelection = function () {\r\n            this.setSelection(null);\r\n        };\r\n        CollaboratorSelection.prototype.refresh = function () {\r\n            this._updateCursor();\r\n            this._updateSelection();\r\n        };\r\n        CollaboratorSelection.prototype._updateCursor = function () {\r\n            if (this._cursor === null && this._container.contains(this._cursorElement)) {\r\n                this._container.removeChild(this._cursorElement);\r\n                this._container.removeChild(this._tooltipElement);\r\n            }\r\n            else {\r\n                if (!this._cursorElement.parentElement) {\r\n                    this._container.append(this._cursorElement);\r\n                    this._container.append(this._tooltipElement);\r\n                }\r\n                var cursorCoords = textareaCaret(this._textInput, this._cursor);\r\n                this._cursorElement.style.height = cursorCoords.height + \"px\";\r\n                this._cursorElement.style.top = cursorCoords.top + \"px\";\r\n                var cursorLeft = (cursorCoords.left - this._cursorElement.offsetWidth / 2);\r\n                this._cursorElement.style.left = cursorLeft + \"px\";\r\n                var toolTipTop = cursorCoords.top - this._tooltipElement.offsetHeight;\r\n                if (toolTipTop + this._container.offsetTop < this._margin) {\r\n                    toolTipTop = cursorCoords.top + cursorCoords.height;\r\n                }\r\n                var toolTipLeft = cursorLeft;\r\n                if (toolTipLeft + this._tooltipElement.offsetWidth > this._container.offsetWidth - this._margin) {\r\n                    toolTipLeft = cursorLeft + this._cursorElement.offsetWidth - this._tooltipElement.offsetWidth;\r\n                }\r\n                this._tooltipElement.style.top = toolTipTop + \"px\";\r\n                this._tooltipElement.style.left = toolTipLeft + \"px\";\r\n            }\r\n        };\r\n        CollaboratorSelection.prototype._updateSelection = function () {\r\n            var _this = this;\r\n            if (this._selection === null) {\r\n                this._rows.forEach(function (row) { return row.element.parentElement.removeChild(row.element); });\r\n                this._rows.splice(0, this._rows.length);\r\n            }\r\n            else {\r\n                var start = void 0;\r\n                var end = void 0;\r\n                if (this._selection.anchor > this._selection.target) {\r\n                    start = Number(this._selection.target);\r\n                    end = Number(this._selection.anchor);\r\n                }\r\n                else {\r\n                    start = Number(this._selection.anchor);\r\n                    end = Number(this._selection.target);\r\n                }\r\n                var newRows = SelectionComputer.calculateSelection(this._textInput, start, end);\r\n                // Adjust size of rows as needed\r\n                var delta = newRows.length - this._rows.length;\r\n                if (delta > 0) {\r\n                    if (this._rows.length === 0 || this._rowsEqual(newRows[0], this._rows[0].rowData)) {\r\n                        this._addNewRows(delta, true);\r\n                    }\r\n                    else {\r\n                        this._addNewRows(delta, false);\r\n                    }\r\n                }\r\n                else if (delta < 0) {\r\n                    var removed = null;\r\n                    if (this._rowsEqual(newRows[0], this._rows[0].rowData)) {\r\n                        // Take from the target.\r\n                        removed = this._rows.splice(this._rows.length - 1 + delta, delta * -1);\r\n                    }\r\n                    else {\r\n                        removed = this._rows.splice(0, delta * -1);\r\n                    }\r\n                    removed.forEach(function (row) { return row.element.parentElement.removeChild(row.element); });\r\n                }\r\n                // Now compare each row and see if we need an update.\r\n                newRows.forEach(function (newRowData, index) {\r\n                    var row = _this._rows[index];\r\n                    _this._updateRow(newRowData, row);\r\n                });\r\n            }\r\n        };\r\n        CollaboratorSelection.prototype._addNewRows = function (count, append) {\r\n            for (var i = 0; i < count; i++) {\r\n                var element = this._container.ownerDocument.createElement(\"div\");\r\n                element.style.position = \"absolute\";\r\n                element.style.backgroundColor = this._color;\r\n                element.style.opacity = \"0.25\";\r\n                this._container.append(element);\r\n                var rowData = { height: 0, width: 0, top: 0, left: 0 };\r\n                var newRow = {\r\n                    element: element,\r\n                    rowData: rowData\r\n                };\r\n                if (append) {\r\n                    this._rows.push(newRow);\r\n                }\r\n                else {\r\n                    this._rows.unshift(newRow);\r\n                }\r\n            }\r\n        };\r\n        CollaboratorSelection.prototype._rowsEqual = function (a, b) {\r\n            return a.height === b.height &&\r\n                a.width === b.width &&\r\n                a.top === b.top &&\r\n                a.left === b.left;\r\n        };\r\n        CollaboratorSelection.prototype._updateRow = function (newRowData, row) {\r\n            if (newRowData.height !== row.rowData.height) {\r\n                row.rowData.height = newRowData.height;\r\n                row.element.style.height = newRowData.height + \"px\";\r\n            }\r\n            if (newRowData.width !== row.rowData.width) {\r\n                row.rowData.width = newRowData.width;\r\n                row.element.style.width = newRowData.width + \"px\";\r\n            }\r\n            if (newRowData.top !== row.rowData.top) {\r\n                row.rowData.top = newRowData.top;\r\n                row.element.style.top = newRowData.top + \"px\";\r\n            }\r\n            if (newRowData.left !== row.rowData.left) {\r\n                row.rowData.left = newRowData.left;\r\n                row.element.style.left = newRowData.left + \"px\";\r\n            }\r\n        };\r\n        return CollaboratorSelection;\r\n    }());\n\n    /*\r\n     * Copyright (c) 2019 Convergence Labs, Inc.\r\n     *\r\n     * This file is part of the HTML Text Collaborative Extensions, which is\r\n     * released under the terms of the MIT license. A copy of the MIT license\r\n     * is usually provided as part of this source code package in the LICENCE\r\n     * file. If it was not, please see <https://opensource.org/licenses/MIT>\r\n     */\r\n    var IndexUtils = /** @class */ (function () {\r\n        function IndexUtils() {\r\n        }\r\n        IndexUtils.transformIndexOnInsert = function (index, insertIndex, value) {\r\n            if (insertIndex <= index) {\r\n                return index + value.length;\r\n            }\r\n            return index;\r\n        };\r\n        IndexUtils.transformIndexOnDelete = function (index, deleteIndex, length) {\r\n            if (index > deleteIndex) {\r\n                return index - Math.min(index - deleteIndex, length);\r\n            }\r\n            return index;\r\n        };\r\n        return IndexUtils;\r\n    }());\n\n    /*\r\n     * Copyright (c) 2019 Convergence Labs, Inc.\r\n     *\r\n     * This file is part of the HTML Text Collaborative Extensions, which is\r\n     * released under the terms of the MIT license. A copy of the MIT license\r\n     * is usually provided as part of this source code package in the LICENCE\r\n     * file. If it was not, please see <https://opensource.org/licenses/MIT>\r\n     */\r\n    /**\r\n     * The CollaborativeSelectionManager controls the monitoring of local selection\r\n     * / cursor positions and renders selections / cursors of collaborators. This\r\n     * class will add an overlay to the DOM on top of the textarea to render\r\n     * collaborators selections.\r\n     */\r\n    var CollaborativeSelectionManager = /** @class */ (function () {\r\n        /**\r\n         * Creates a new [[CollaborativeSelectionManager]].\r\n         *\r\n         * @param options The options that configure this instance.\r\n         */\r\n        function CollaborativeSelectionManager(options) {\r\n            var _this = this;\r\n            this._checkSelection = function () {\r\n                setTimeout(function () {\r\n                    var changed = _this._textElement.selectionStart !== _this._selectionAnchor ||\r\n                        _this._textElement.selectionEnd !== _this._selectionTarget;\r\n                    if (changed) {\r\n                        if (_this._selectionAnchor === _this._textElement.selectionStart) {\r\n                            _this._selectionAnchor = _this._textElement.selectionStart;\r\n                            _this._selectionTarget = _this._textElement.selectionEnd;\r\n                        }\r\n                        else {\r\n                            _this._selectionAnchor = _this._textElement.selectionEnd;\r\n                            _this._selectionTarget = _this._textElement.selectionStart;\r\n                        }\r\n                        _this._onSelection({\r\n                            anchor: _this._selectionAnchor,\r\n                            target: _this._selectionTarget\r\n                        });\r\n                    }\r\n                }, 0);\r\n            };\r\n            this._onMouseMove = function () {\r\n                _this._checkResize();\r\n                _this._checkSelection();\r\n            };\r\n            this._checkResize = function () {\r\n                if (_this._textElement.offsetWidth !== _this._overlayContainer.offsetWidth ||\r\n                    _this._textElement.offsetHeight !== _this._overlayContainer.offsetHeight ||\r\n                    _this._textElement.offsetTop !== _this._overlayContainer.offsetTop ||\r\n                    _this._textElement.offsetLeft !== _this._overlayContainer.offsetLeft) {\r\n                    _this.onResize();\r\n                    _this._collaborators.forEach(function (renderer) { return renderer.refresh(); });\r\n                }\r\n            };\r\n            this._collaborators = new Map();\r\n            this._textElement = options.control;\r\n            // TODO handle the line height better. The issue here\r\n            //  is that the textarea-caret library can't handle\r\n            //  a non-number.\r\n            var computed = window.getComputedStyle(this._textElement);\r\n            if (computed.lineHeight === \"normal\") {\r\n                throw new Error(\"Text areas must have a numeric line-height.\");\r\n            }\r\n            this._onSelection = options.onSelectionChanged;\r\n            this._selectionAnchor = this._textElement.selectionStart;\r\n            this._selectionTarget = this._textElement.selectionEnd;\r\n            this._overlayContainer = this._textElement.ownerDocument.createElement(\"div\");\r\n            this._overlayContainer.className = \"text-collab-ext\";\r\n            this._textElement.parentElement.append(this._overlayContainer);\r\n            this._scroller = this._textElement.ownerDocument.createElement(\"div\");\r\n            this._scroller.className = \"text-collab-ext-scroller\";\r\n            this._overlayContainer.append(this._scroller);\r\n            // Provide resize handling. After the mose down, we register for mouse\r\n            // movement and check if we have resized. We then listen for a mouse up\r\n            // to unregister.\r\n            this._textElement.addEventListener(\"mousedown\", function () {\r\n                window.addEventListener(\"mousemove\", _this._onMouseMove);\r\n            });\r\n            window.addEventListener(\"mouseup\", function () {\r\n                window.removeEventListener(\"mousemove\", _this._onMouseMove);\r\n                _this._checkResize();\r\n            });\r\n            this._textElement.addEventListener(\"scroll\", function () { return _this._updateScroller(); });\r\n            this._textElement.addEventListener(\"keydown\", this._checkSelection);\r\n            this._textElement.addEventListener(\"click\", this._checkSelection);\r\n            this._textElement.addEventListener(\"focus\", this._checkSelection);\r\n            this._textElement.addEventListener(\"blur\", this._checkSelection);\r\n            this.onResize();\r\n        }\r\n        /**\r\n         * Adds a remote collaborator to the textarea so that their cursor /\r\n         * selection can be rendered.\r\n         *\r\n         * @param id A unique identifier for this collaborator.\r\n         * @param label A text label to render over the cursor.\r\n         * @param color The color to use for the cursor and selection.\r\n         * @param selection The initial selection to render, if desired.\r\n         *\r\n         * @returns A [[CollaboratorSelection]] that can be used to control\r\n         *   the selection / cursor for this collaborator\r\n         */\r\n        CollaborativeSelectionManager.prototype.addCollaborator = function (id, label, color, selection) {\r\n            if (this._collaborators.has(id)) {\r\n                throw new Error(\"A collaborator with the specified id already exists: \" + id);\r\n            }\r\n            var collaborator = new CollaboratorSelection(this._textElement, this._scroller, color, label, { margin: 5 });\r\n            this._collaborators.set(id, collaborator);\r\n            if (selection !== undefined && selection !== null) {\r\n                collaborator.setSelection(selection);\r\n            }\r\n            return collaborator;\r\n        };\r\n        /**\r\n         * Get the [[CollaboratorSelection]] for the specified collaborator.\r\n         *\r\n         * @param id The id of the collaborator to get the selection of.\r\n         *\r\n         * returns A [[CollaboratorSelection]] that can be used to control\r\n         *   the selection / cursor for this collaborator\r\n         */\r\n        CollaborativeSelectionManager.prototype.getCollaborator = function (id) {\r\n            return this._collaborators.get(id);\r\n        };\r\n        /**\r\n         *\r\n         * @param id The id of the collaborator to remove.\r\n         */\r\n        CollaborativeSelectionManager.prototype.removeCollaborator = function (id) {\r\n            var renderer = this._collaborators.get(id);\r\n            if (renderer !== undefined) {\r\n                renderer.clearSelection();\r\n                this._collaborators.delete(id);\r\n            }\r\n            else {\r\n                throw new Error(\"Unknown collaborator: \" + id);\r\n            }\r\n        };\r\n        /**\r\n         * Gets the local users selection.\r\n         */\r\n        CollaborativeSelectionManager.prototype.getSelection = function () {\r\n            return {\r\n                anchor: this._selectionAnchor,\r\n                target: this._selectionTarget\r\n            };\r\n        };\r\n        /**\r\n         * Shows collaborators selections, if hidden.\r\n         */\r\n        CollaborativeSelectionManager.prototype.show = function () {\r\n            this._overlayContainer.style.visibility = \"visible\";\r\n        };\r\n        /**\r\n         * Hides the collaborators selections, if shown.\r\n         */\r\n        CollaborativeSelectionManager.prototype.hide = function () {\r\n            this._overlayContainer.style.visibility = \"hidden\";\r\n        };\r\n        /**\r\n         * Removes the collaborator selection rendering from the DOM.\r\n         */\r\n        CollaborativeSelectionManager.prototype.dispose = function () {\r\n            this._overlayContainer.parentElement.removeChild(this._overlayContainer);\r\n        };\r\n        /**\r\n         * Indicates that the textarea has been resized and the collaboration\r\n         * overlay should be resized to match.\r\n         */\r\n        CollaborativeSelectionManager.prototype.onResize = function () {\r\n            var top = this._textElement.offsetTop;\r\n            var left = this._textElement.offsetLeft;\r\n            var height = this._textElement.offsetHeight;\r\n            var width = this._textElement.offsetWidth;\r\n            this._overlayContainer.style.top = top + \"px\";\r\n            this._overlayContainer.style.left = left + \"px\";\r\n            this._overlayContainer.style.height = height + \"px\";\r\n            this._overlayContainer.style.width = width + \"px\";\r\n        };\r\n        CollaborativeSelectionManager.prototype.updateSelectionsOnInsert = function (index, value) {\r\n            this._collaborators.forEach(function (collaborator) {\r\n                var selection = collaborator.getSelection();\r\n                var anchor = IndexUtils.transformIndexOnInsert(selection.anchor, index, value);\r\n                var target = IndexUtils.transformIndexOnInsert(selection.target, index, value);\r\n                collaborator.setSelection({ anchor: anchor, target: target });\r\n            });\r\n        };\r\n        CollaborativeSelectionManager.prototype.updateSelectionsOnDelete = function (index, length) {\r\n            this._collaborators.forEach(function (collaborator) {\r\n                var selection = collaborator.getSelection();\r\n                var anchor = IndexUtils.transformIndexOnDelete(selection.anchor, index, length);\r\n                var target = IndexUtils.transformIndexOnDelete(selection.target, index, length);\r\n                collaborator.setSelection({ anchor: anchor, target: target });\r\n            });\r\n        };\r\n        CollaborativeSelectionManager.prototype._updateScroller = function () {\r\n            this._scroller.style.top = (this._textElement.scrollTop * -1) + \"px\";\r\n            this._scroller.style.left = (this._textElement.scrollLeft * -1) + \"px\";\r\n        };\r\n        return CollaborativeSelectionManager;\r\n    }());\n\n    var StringChangeDetector_1 = createCommonjsModule(function (module, exports) {\n\n    Object.defineProperty(exports, \"__esModule\", {\n      value: true\n    });\n\n    var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\n    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n    var StringChangeDetector = exports.StringChangeDetector = function () {\n      function StringChangeDetector(options) {\n        _classCallCheck(this, StringChangeDetector);\n\n        if (!options) {\n          throw new Error(\"options must be defined\");\n        }\n\n        if (typeof options.onInsert !== \"function\") {\n          throw new Error(\"options.onInsert must be a function\");\n        }\n\n        if (typeof options.onRemove !== \"function\") {\n          throw new Error(\"options.onRemove must be a function\");\n        }\n\n        if (typeof options.value !== \"string\") {\n          throw new Error(\"options.value must be a string\");\n        }\n\n        this._onInsert = options.onInsert;\n        this._onRemove = options.onRemove;\n        this._value = options.value;\n      }\n\n      /**\n       * Inserts a string into the current value at the specified index.\n       *\n       * @param index {number}\n       *    The index in the string to insert into.\n       * @param value {string}\n       *   The value to insert into the string.\n       */\n\n\n      _createClass(StringChangeDetector, [{\n        key: \"insertText\",\n        value: function insertText(index, value) {\n          var oldVal = this._value;\n          var newVal = oldVal.substring(0, index) + value + oldVal.substring(index, oldVal.length);\n          this.setValue(newVal);\n        }\n\n        /**\n         * Removes a specified number of characters from the current string at\n         * a specific location.\n         *\n         * @param index {number}\n         *    The index in the string to remove characters.\n         * @param length {number}\n         *   The number of characters to remove.\n         */\n\n      }, {\n        key: \"removeText\",\n        value: function removeText(index, length) {\n          var oldVal = this._value;\n          var newVal = oldVal.substring(0, index) + oldVal.substring(index + length, oldVal.length);\n          this.setValue(newVal);\n        }\n\n        /**\n         * Sets the current value of the string.\n         *\n         * @param value {string}\n         *   The new value of the string.\n         */\n\n      }, {\n        key: \"setValue\",\n        value: function setValue(value) {\n          this._value = value;\n        }\n\n        /**\n         * Gets the current value of the string.\n         *\n         * @returns {string}\n         */\n\n      }, {\n        key: \"getValue\",\n        value: function getValue() {\n          return this._value;\n        }\n\n        /**\n         * Process the new value of the string after a single edit.\n         *\n         * @param newValue {string}\n         *   The new value to process.\n         */\n\n      }, {\n        key: \"processNewValue\",\n        value: function processNewValue(newValue) {\n          var commonEnd = 0;\n          var commonStart = 0;\n\n          if (this._value === newValue) {\n            return;\n          }\n\n          while (this._value.charAt(commonStart) === newValue.charAt(commonStart)) {\n            commonStart++;\n          }\n\n          while (this._value.charAt(this._value.length - 1 - commonEnd) === newValue.charAt(newValue.length - 1 - commonEnd) && commonEnd + commonStart < this._value.length && commonEnd + commonStart < newValue.length) {\n            commonEnd++;\n          }\n\n          // Characters were removed.\n          if (this._value.length !== commonStart + commonEnd) {\n            if (this._onRemove) {\n              this._onRemove(commonStart, this._value.length - commonStart - commonEnd);\n            }\n          }\n\n          // Characters were added\n          if (newValue.length !== commonStart + commonEnd) {\n            if (this._onInsert) {\n              this._onInsert(commonStart, newValue.slice(commonStart, newValue.length - commonEnd));\n            }\n          }\n\n          this._value = newValue;\n        }\n      }]);\n\n      return StringChangeDetector;\n    }();\n\n    });\n\n    unwrapExports(StringChangeDetector_1);\n    var StringChangeDetector_2 = StringChangeDetector_1.StringChangeDetector;\n\n    var lib = StringChangeDetector_1.StringChangeDetector;\n\n    /*\r\n     * Copyright (c) 2019 Convergence Labs, Inc.\r\n     *\r\n     * This file is part of the HTML Text Collaborative Extensions, which is\r\n     * released under the terms of the MIT license. A copy of the MIT license\r\n     * is usually provided as part of this source code package in the LICENCE\r\n     * file. If it was not, please see <https://opensource.org/licenses/MIT>\r\n     */\r\n    var TextInputManager = /** @class */ (function () {\r\n        /**\r\n         *\r\n         * @param options\r\n         */\r\n        function TextInputManager(options) {\r\n            var _this = this;\r\n            this._onLocalInput = function () {\r\n                _this._changeDetector.processNewValue(_this._control.value);\r\n            };\r\n            this._control = options.control;\r\n            this._onLocalInsert = options.onInsert;\r\n            this._onLocalDelete = options.onDelete;\r\n            this._changeDetector = null;\r\n            this.bind();\r\n        }\r\n        TextInputManager.prototype.bind = function () {\r\n            this._changeDetector = new lib({\r\n                value: this._control.value,\r\n                onInsert: this._onLocalInsert,\r\n                onRemove: this._onLocalDelete\r\n            });\r\n            this._control.addEventListener(\"input\", this._onLocalInput);\r\n        };\r\n        TextInputManager.prototype.unbind = function () {\r\n            this._control.removeEventListener(\"input\", this._onLocalInput);\r\n            this._changeDetector = null;\r\n        };\r\n        TextInputManager.prototype.insertText = function (index, value) {\r\n            this._assertBound();\r\n            var _a = this._getSelection(), start = _a.start, end = _a.end;\r\n            var xStart = IndexUtils.transformIndexOnInsert(start, index, value);\r\n            var xEnd = IndexUtils.transformIndexOnInsert(end, index, value);\r\n            this._changeDetector.insertText(index, value);\r\n            this._updateControl();\r\n            this._setTextSelection(xStart, xEnd);\r\n        };\r\n        TextInputManager.prototype.deleteText = function (index, length) {\r\n            this._assertBound();\r\n            var _a = this._getSelection(), start = _a.start, end = _a.end;\r\n            var xStart = IndexUtils.transformIndexOnDelete(start, index, length);\r\n            var xEnd = IndexUtils.transformIndexOnDelete(end, index, length);\r\n            this._changeDetector.removeText(index, length);\r\n            this._updateControl();\r\n            this._setTextSelection(xStart, xEnd);\r\n        };\r\n        TextInputManager.prototype.setText = function (value) {\r\n            this._assertBound();\r\n            this._changeDetector.setValue(value);\r\n            this._updateControl();\r\n            this._setTextSelection(0, 0);\r\n        };\r\n        TextInputManager.prototype.setTextOnInsertWithSelections = function (text, index, value) {\r\n            this._assertBound();\r\n            var _a = this._getSelection(), start = _a.start, end = _a.end;\r\n            var xStart = IndexUtils.transformIndexOnInsert(start, index, value);\r\n            var xEnd = IndexUtils.transformIndexOnInsert(end, index, value);\r\n            this._changeDetector.setValue(text);\r\n            this._updateControl();\r\n            this._setTextSelection(xStart, xEnd);\r\n        };\r\n        TextInputManager.prototype.setTextOnDeleteWithSelections = function (text, index, length) {\r\n            this._assertBound();\r\n            var _a = this._getSelection(), start = _a.start, end = _a.end;\r\n            var xStart = IndexUtils.transformIndexOnDelete(start, index, length);\r\n            var xEnd = IndexUtils.transformIndexOnDelete(end, index, length);\r\n            this._changeDetector.setValue(text);\r\n            this._updateControl();\r\n            this._setTextSelection(xStart, xEnd);\r\n        };\r\n        TextInputManager.prototype.getText = function () {\r\n            return this._control.value;\r\n        };\r\n        TextInputManager.prototype._updateControl = function () {\r\n            this._control.value = this._changeDetector.getValue();\r\n        };\r\n        TextInputManager.prototype._assertBound = function () {\r\n            if (this._changeDetector === null) {\r\n                throw new Error(\"The TextInputManager is not bound.\");\r\n            }\r\n        };\r\n        TextInputManager.prototype._getSelection = function () {\r\n            return { 'start': this._control.selectionStart, 'end': this._control.selectionEnd };\r\n        };\r\n        TextInputManager.prototype._setTextSelection = function (start, end) {\r\n            this._control.setSelectionRange(start, end);\r\n        };\r\n        return TextInputManager;\r\n    }());\n\n    /*\r\n     * Copyright (c) 2019 Convergence Labs, Inc.\r\n     *\r\n     * This file is part of the HTML Text Collaborative Extensions, which is\r\n     * released under the terms of the MIT license. A copy of the MIT license\r\n     * is usually provided as part of this source code package in the LICENCE\r\n     * file. If it was not, please see <https://opensource.org/licenses/MIT>\r\n     */\r\n    /**\r\n     * Adapts a plain HTMLTextAreaElement to add collaborative editing\r\n     * capabilities. This class will add an overlay HTMLDivElement on\r\n     * top of the HTMLTextAreaElement to render cursors and selection\r\n     * of collaborators. This class also adds convenience API to\r\n     * mutate the text area value and to get events / callbacks when\r\n     * the value is changed by the user. Mutation methods and mutation\r\n     * events are granular describing exactly how the value was changed.\r\n     */\r\n    var CollaborativeTextArea = /** @class */ (function () {\r\n        /**\r\n         * Creates a new [[CollaborativeTextArea]].\r\n         *\r\n         * @param options The options to configure this instance.\r\n         */\r\n        function CollaborativeTextArea(options) {\r\n            var _this = this;\r\n            if (!options) {\r\n                throw new Error(\"options must be defined.\");\r\n            }\r\n            if (!options.control) {\r\n                throw new Error(\"options.control must be defined.\");\r\n            }\r\n            var control = options.control;\r\n            var insertCallback = options.onInsert;\r\n            var deleteCallback = options.onDelete;\r\n            var onInsert = function (index, value) {\r\n                _this._selectionManager.updateSelectionsOnInsert(index, value);\r\n                if (insertCallback) {\r\n                    insertCallback(index, value);\r\n                }\r\n            };\r\n            var onDelete = function (index, length) {\r\n                _this._selectionManager.updateSelectionsOnDelete(index, length);\r\n                if (deleteCallback) {\r\n                    deleteCallback(index, length);\r\n                }\r\n            };\r\n            var onSelectionChanged = options.onSelectionChanged !== undefined ?\r\n                options.onSelectionChanged : function (_) {\r\n                // No-op\r\n            };\r\n            this._inputManager = new TextInputManager({ control: control, onInsert: onInsert, onDelete: onDelete });\r\n            this._selectionManager = new CollaborativeSelectionManager({ control: control, onSelectionChanged: onSelectionChanged });\r\n        }\r\n        /**\r\n         * Inserts text into the textarea.\r\n         *\r\n         * @param index The index at which to insert the text.\r\n         * @param value The text to insert.\r\n         */\r\n        CollaborativeTextArea.prototype.insertText = function (index, value) {\r\n            this._inputManager.insertText(index, value);\r\n            this._selectionManager.updateSelectionsOnInsert(index, value);\r\n        };\r\n        /**\r\n         * Deletes text from the textarea.\r\n         * @param index The index at which to remove text.\r\n         * @param length The number of characters to remove.\r\n         */\r\n        CollaborativeTextArea.prototype.deleteText = function (index, length) {\r\n            this._inputManager.deleteText(index, length);\r\n            this._selectionManager.updateSelectionsOnDelete(index, length);\r\n        };\r\n        /**\r\n         * Sets the entire value of the textarea.\r\n         *\r\n         * @param value The value to set.\r\n         */\r\n        CollaborativeTextArea.prototype.setText = function (value) {\r\n            this._inputManager.setText(value);\r\n        };\r\n        CollaborativeTextArea.prototype.setTextOnInsertWithSelections = function (text, index, value) {\r\n            this._inputManager.setTextOnInsertWithSelections(text, index, value);\r\n            this._selectionManager.updateSelectionsOnInsert(index, value);\r\n        };\r\n        CollaborativeTextArea.prototype.setTextOnDeleteWithSelections = function (text, index, length) {\r\n            this._inputManager.setTextOnDeleteWithSelections(text, index, length);\r\n            this._selectionManager.updateSelectionsOnDelete(index, length);\r\n        };\r\n        /**\r\n         * Gets the current text of the textarea.\r\n         */\r\n        CollaborativeTextArea.prototype.getText = function () {\r\n            return this._inputManager.getText();\r\n        };\r\n        /**\r\n         * Gets the selection manager that controls local and collaborator\r\n         * selections.\r\n         */\r\n        CollaborativeTextArea.prototype.selectionManager = function () {\r\n            return this._selectionManager;\r\n        };\r\n        /**\r\n         * Indicates that the textarea has been resized and the collaboration\r\n         * overlay should be resized to match.\r\n         */\r\n        CollaborativeTextArea.prototype.onResize = function () {\r\n            this._selectionManager.onResize();\r\n        };\r\n        return CollaborativeTextArea;\r\n    }());\n\n    exports.CollaborativeSelectionManager = CollaborativeSelectionManager;\n    exports.CollaborativeTextArea = CollaborativeTextArea;\n    exports.CollaboratorSelection = CollaboratorSelection;\n    exports.TextInputManager = TextInputManager;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=html-text-collab-ext.js.map\n"],"names":["global","factory","exports","module","define","amd","self","HtmlTextCollabExt","this","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","createCommonjsModule","fn","textareaCaret","properties","isBrowser","isFirefox","window","mozInnerScreenX","element","position","options","Error","el","debug","document","querySelector","parentNode","removeChild","div","createElement","id","body","appendChild","style","computed","getComputedStyle","currentStyle","isInput","nodeName","whiteSpace","wordWrap","visibility","forEach","prop","lineHeight","height","scrollHeight","parseInt","overflowY","textContent","value","substring","replace","span","coordinates","top","offsetTop","left","offsetLeft","backgroundColor","SelectionComputer","calculateSelection","start","end","selectionRows","appendSingleLineSelection","startCoordinates","endCoordinates","_a","push","buildSingleLineSelection","width","buildWrappedLineSelections","rows","scrollWidth","elementPaddingRight","elementPaddingX","elementPaddingLeft","buildMultiRowSelection","lastLine","currentCoordinates","currentIndex","nextLineBreakPosition","indexOf","endOfLinePosition","endOfLineCoordinates","parseFloat","paddingLeft","paddingRight","substr","CollaboratorSelection","showSelection","_rows","row","hideSelection","showCursor","_cursorElement","hideCursor","showCursorToolTip","_clearToolTipTimeout","_tooltipElement","opacity","flashCursorToolTip","duration","_this","_tooltipTimeout","setTimeout","hideCursorTooltip","clearTimeout","setColor","color","_color","background","setSelection","selection","_cursor","_selection","target","refresh","getSelection","clearSelection","_updateCursor","_updateSelection","cursorCoords","cursorLeft","toolTipTop","toolTipLeft","_container","contains","parentElement","append","_textInput","offsetWidth","offsetHeight","_margin","newRows","delta","splice","anchor","Number","_rowsEqual","rowData","_addNewRows","newRowData","index","_updateRow","count","ownerDocument","newRow","unshift","a","b","textInput","overlayContainer","label","_label","margin","className","innerHTML","IndexUtils","transformIndexOnInsert","insertIndex","transformIndexOnDelete","deleteIndex","Math","min","CollaborativeSelectionManager","addCollaborator","_collaborators","has","collaborator","_textElement","_scroller","set","getCollaborator","get","removeCollaborator","renderer","undefined","delete","_selectionAnchor","_selectionTarget","show","_overlayContainer","hide","dispose","onResize","updateSelectionsOnInsert","updateSelectionsOnDelete","_updateScroller","scrollTop","scrollLeft","_checkSelection","selectionStart","selectionEnd","_onSelection","_onMouseMove","_checkResize","Map","control","onSelectionChanged","addEventListener","removeEventListener","x","StringChangeDetector_1","defineProperty","_createClass","Constructor","protoProps","staticProps","defineProperties","props","descriptor","enumerable","configurable","writable","key","StringChangeDetector","oldVal","_value","newVal","setValue","newValue","commonEnd","commonStart","charAt","_onRemove","_onInsert","slice","instance","TypeError","_classCallCheck","onInsert","onRemove","__esModule","lib","TextInputManager","bind","_changeDetector","_control","_onLocalInsert","_onLocalDelete","_onLocalInput","unbind","insertText","_assertBound","_getSelection","xStart","xEnd","_updateControl","_setTextSelection","deleteText","removeText","setText","setTextOnInsertWithSelections","text","setTextOnDeleteWithSelections","getText","getValue","setSelectionRange","processNewValue","onDelete","CollaborativeTextArea","_inputManager","_selectionManager","selectionManager","insertCallback","deleteCallback","_"],"mappings":"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"}